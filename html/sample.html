<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TESDA: ACLC Scholarship Portal - Register</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            display: flex;
            max-width: 1200px;
            width: 100%;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        /* Left Side - Registration Steps */
        .steps-section {
            flex: 1;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px;
            display: flex;
            flex-direction: column;
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 40px;
        }

        .logo-icon {
            font-size: 32px;
            margin-right: 15px;
        }

        .logo-text h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .logo-text p {
            font-size: 14px;
            opacity: 0.9;
        }

        .steps-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .step {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            opacity: 0.6;
            transition: all 0.3s;
        }

        .step.active {
            opacity: 1;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            font-size: 18px;
        }

        .step.active .step-number {
            background: white;
            color: #1e3c72;
        }

        .step-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .step-info p {
            font-size: 14px;
            opacity: 0.8;
        }

        .progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            margin: 40px 0;
            position: relative;
        }

        .progress-fill {
            position: absolute;
            height: 100%;
            background: white;
            border-radius: 2px;
            width: 33%;
            transition: width 0.5s;
        }

        /* Right Side - Registration Form */
        .register-section {
            flex: 2;
            padding: 40px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .register-header {
            margin-bottom: 30px;
        }

        .register-header h2 {
            color: #1e3c72;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .register-header p {
            color: #666;
            font-size: 16px;
        }

        /* Form Styles */
        .form-container {
            display: none;
        }

        .form-container.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #444;
            font-weight: 500;
            font-size: 14px;
        }

        label.required:after {
            content: " *";
            color: #e53935;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5ee;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        .select-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5ee;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }

        .form-hint {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .error-message {
            color: #e53935;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            color: #43a047;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .terms-container {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .terms-text {
            font-size: 14px;
            line-height: 1.6;
            color: #555;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            margin: 15px 0;
        }

        .checkbox-group input {
            margin-top: 3px;
            margin-right: 10px;
            accent-color: #2a5298;
        }

        .checkbox-group label {
            font-size: 14px;
            color: #555;
            font-weight: normal;
        }

        .checkbox-group a {
            color: #2a5298;
            text-decoration: none;
        }

        .checkbox-group a:hover {
            text-decoration: underline;
        }

        /* Navigation Buttons */
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e1e5ee;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-prev {
            background: #f8f9fa;
            color: #444;
            border: 2px solid #e1e5ee;
        }

        .btn-prev:hover {
            background: #e9ecef;
        }

        .btn-next, .btn-submit {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
        }

        .btn-next:hover, .btn-submit:hover {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(42, 82, 152, 0.3);
        }

        .btn-submit {
            background: linear-gradient(135deg, #2e7d32 0%, #43a047 100%);
        }

        .btn-submit:hover {
            background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);
        }

        /* Login Link */
        .login-link {
            text-align: center;
            margin-top: 30px;
            color: #666;
        }

        .login-link a {
            color: #2a5298;
            text-decoration: none;
            font-weight: 600;
        }

        .login-link a:hover {
            text-decoration: underline;
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .container {
                flex-direction: column;
            }
            
            .steps-section {
                padding: 30px;
            }
            
            .register-section {
                padding: 30px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }

        /* Password Strength Indicator */
        .password-strength {
            height: 4px;
            background: #e1e5ee;
            border-radius: 2px;
            margin-top: 5px;
            overflow: hidden;
        }

        .strength-bar {
            height: 100%;
            width: 0;
            border-radius: 2px;
            transition: all 0.3s;
        }

        .strength-weak { background: #e53935; width: 25%; }
        .strength-fair { background: #ff9800; width: 50%; }
        .strength-good { background: #ffb300; width: 75%; }
        .strength-strong { background: #43a047; width: 100%; }
    </style>
</head>
<body>

    <div class="container">
        <!-- Left Side: Registration Steps -->
        <div class="steps-section">
            <div class="logo">
                <div class="logo-icon">ðŸŽ“</div>
                <div class="logo-text">
                    <h1>TESDA: ACLC</h1>
                    <p>Scholarship Portal</p>
                </div>
            </div>

            <div class="steps-container">
                <!-- Step 1: Personal Information -->
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-info">
                        <h3>Personal Information</h3>
                        <p>Tell us about yourself</p>
                    </div>
                </div>

                <!-- Step 2: Account Setup -->
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-info">
                        <h3>Account Setup</h3>
                        <p>Create login credentials</p>
                    </div>
                </div>

                <!-- Step 3: Terms & Agreement -->
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-info">
                        <h3>Terms & Agreement</h3>
                        <p>Review and accept terms</p>
                    </div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <!-- Right Side: Registration Form -->
        <div class="register-section">
            <div class="register-header">
                <h2>Create Account</h2>
                <p>Join the TESDA Scholarship Portal in 3 simple steps</p>
            </div>

            <!-- Step 1: Personal Information ONLY -->
            <div class="form-container active" id="step1">
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName" class="required">First Name</label>
                        <input type="text" id="firstName" class="form-control" placeholder="Enter your first name">
                        <div class="error-message" id="firstNameError">First name is required</div>
                    </div>
                    <div class="form-group">
                        <label for="lastName" class="required">Last Name</label>
                        <input type="text" id="lastName" class="form-control" placeholder="Enter your last name">
                        <div class="error-message" id="lastNameError">Last name is required</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="email" class="required">Email Address</label>
                    <input type="email" id="email" class="form-control" placeholder="example@email.com">
                    <div class="error-message" id="emailError">Please enter a valid email address</div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="phone" class="required">Phone Number</label>
                        <input type="tel" id="phone" class="form-control" placeholder="0912 345 6789">
                        <div class="error-message" id="phoneError">Please enter a valid phone number</div>
                    </div>
                    <div class="form-group">
                        <label for="birthdate" class="required">Date of Birth</label>
                        <input type="date" id="birthdate" class="form-control">
                        <div class="error-message" id="birthdateError">You must be at least 16 years old</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="address" class="required">Address</label>
                        <input type="text" id="address" class="form-control" placeholder="Street, Barangay, City">
                        <div class="error-message" id="addressError">Address is required</div>
                    </div>
                    <div class="form-group">
                        <label for="gender" class="required">Gender</label>
                        <select id="gender" class="select-control">
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Prefer not to say</option>
                        </select>
                        <div class="error-message" id="genderError">Please select your gender</div>
                    </div>
                </div>

                <div class="form-navigation">
                    <div></div>
                    <button type="button" class="btn btn-next" onclick="nextStep()">Next Step</button>
                </div>
            </div>

            <!-- Step 2: Account Setup -->
            <div class="form-container" id="step2">
                <div class="form-group">
                    <label for="username" class="required">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Choose a username">
                    <div class="error-message" id="usernameError">Username must be 3-20 characters</div>
                    <div class="success-message" id="usernameSuccess">Username available!</div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="password" class="required">Password</label>
                        <input type="password" id="password" class="form-control" placeholder="Create a strong password">
                        <div class="password-strength">
                            <div class="strength-bar" id="passwordStrength"></div>
                        </div>
                        <div class="error-message" id="passwordError">Password must be at least 8 characters</div>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword" class="required">Confirm Password</label>
                        <input type="password" id="confirmPassword" class="form-control" placeholder="Re-enter your password">
                        <div class="error-message" id="confirmPasswordError">Passwords do not match</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="securityQuestion" class="required">Security Question</label>
                    <select id="securityQuestion" class="select-control">
                        <option value="">Select a security question</option>
                        <option value="pet">What was your first pet's name?</option>
                        <option value="school">What elementary school did you attend?</option>
                        <option value="city">In what city were you born?</option>
                        <option value="mother">What is your mother's maiden name?</option>
                    </select>
                    <div class="error-message" id="securityQuestionError">Please select a security question</div>
                </div>

                <div class="form-group">
                    <label for="securityAnswer" class="required">Security Answer</label>
                    <input type="text" id="securityAnswer" class="form-control" placeholder="Your answer">
                    <div class="error-message" id="securityAnswerError">Security answer is required</div>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-prev" onclick="prevStep()">Previous</button>
                    <button type="button" class="btn btn-next" onclick="nextStep()">Next Step</button>
                </div>
            </div>

            <!-- Step 3: Terms & Agreement -->
            <div class="form-container" id="step3">
                <div class="form-group">
                    <label class="required">Terms and Conditions</label>
                    <div class="terms-container">
                        <div class="terms-text">
                            <h4>TESDA Scholarship Program Agreement</h4>
                            <p>By registering for the TESDA Scholarship Portal, you agree to the following terms:</p>
                            <ol>
                                <li>You certify that all information provided is true and accurate.</li>
                                <li>You agree to use the portal for legitimate scholarship applications only.</li>
                                <li>You understand that program selection happens after login.</li>
                                <li>You consent to the collection and processing of your personal data for account management purposes.</li>
                                <li>You agree to comply with all TESDA and ACLC College policies and regulations.</li>
                                <li>You are responsible for maintaining the confidentiality of your account credentials.</li>
                                <li>You must complete your profile with additional information after logging in.</li>
                                <li>You understand that scholarship slots are limited and acceptance is competitive.</li>
                            </ol>
                            <p><strong>Note:</strong> After registration, you will need to login and complete your profile before applying for specific scholarship programs.</p>
                        </div>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="termsAgreement">
                    <label for="termsAgreement">
                        I have read and agree to the <a href="#">Terms and Conditions</a> of the TESDA Scholarship Portal.
                    </label>
                </div>
                <div class="error-message" id="termsError">You must accept the terms and conditions</div>

                <div class="checkbox-group">
                    <input type="checkbox" id="privacyAgreement">
                    <label for="privacyAgreement">
                        I agree to the collection and processing of my personal data as described in the <a href="#">Privacy Policy</a>.
                    </label>
                </div>
                <div class="error-message" id="privacyError">You must accept the privacy policy</div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-prev" onclick="prevStep()">Previous</button>
                    <button type="button" class="btn btn-submit" onclick="submitForm()">Create Account</button>
                </div>
            </div>

            <div class="login-link">
                <p>Already have an account? <a href="login.html">Sign in here</a></p>
            </div>
        </div>
    </div>

    <script>
        // ===== ENCRYPTION FUNCTIONS =====
        
        // Encryption key - In a real application, this should be more secure
        // This is a simple XOR-based encryption for demonstration
        const ENCRYPTION_KEY = "TESDA_ACLC_SCHOLARSHIP_2024_SECURE_KEY";
        
        // Simple encryption function using XOR and Base64
        function encryptText(text) {
            if (!text) return "";
            
            let encrypted = "";
            for (let i = 0; i < text.length; i++) {
                // XOR each character with corresponding key character
                const charCode = text.charCodeAt(i) ^ ENCRYPTION_KEY.charCodeAt(i % ENCRYPTION_KEY.length);
                encrypted += String.fromCharCode(charCode);
            }
            
            // Convert to Base64 to make it look encrypted
            return btoa(encrypted);
        }
        
        // Simple decryption function
        function decryptText(encryptedText) {
            if (!encryptedText) return "";
            
            try {
                // Decode from Base64
                const decoded = atob(encryptedText);
                
                let decrypted = "";
                for (let i = 0; i < decoded.length; i++) {
                    // XOR again to get original text
                    const charCode = decoded.charCodeAt(i) ^ ENCRYPTION_KEY.charCodeAt(i % ENCRYPTION_KEY.length);
                    decrypted += String.fromCharCode(charCode);
                }
                
                return decrypted;
            } catch (e) {
                console.error("Decryption error:", e);
                return "";
            }
        }
        
        // For login verification (without storing decrypted version)
        function verifyPassword(inputPassword, storedEncryptedPassword) {
            // Encrypt the input password with the same method
            const encryptedInput = encryptText(inputPassword);
            // Compare the encrypted versions
            return encryptedInput === storedEncryptedPassword;
        }
        
        // For security answer verification
        function verifySecurityAnswer(inputAnswer, storedEncryptedAnswer) {
            // Encrypt the input answer with the same method
            const encryptedInput = encryptText(inputAnswer);
            // Compare the encrypted versions
            return encryptedInput === storedEncryptedAnswer;
        }

        // ===== XML INTEGRATION FOR PERSONAL INFORMATION =====
        
        // Function to convert personal data to XML
        function convertPersonalDataToXML(personalData) {
            const xmlDoc = document.implementation.createDocument(null, "PersonalInformation");
            const root = xmlDoc.documentElement;
            
            // Create XML elements for each field
            const firstName = xmlDoc.createElement("FirstName");
            firstName.textContent = personalData.firstName || "";
            root.appendChild(firstName);
            
            const lastName = xmlDoc.createElement("LastName");
            lastName.textContent = personalData.lastName || "";
            root.appendChild(lastName);
            
            const email = xmlDoc.createElement("Email");
            email.textContent = personalData.email || "";
            root.appendChild(email);
            
            const phone = xmlDoc.createElement("PhoneNumber");
            phone.textContent = personalData.phone || "";
            root.appendChild(phone);
            
            const birthdate = xmlDoc.createElement("DateOfBirth");
            birthdate.textContent = personalData.birthdate || "";
            root.appendChild(birthdate);
            
            const address = xmlDoc.createElement("Address");
            address.textContent = personalData.address || "";
            root.appendChild(address);
            
            const gender = xmlDoc.createElement("Gender");
            gender.textContent = personalData.gender || "";
            root.appendChild(gender);
            
            // Convert XML document to string
            const serializer = new XMLSerializer();
            return serializer.serializeToString(xmlDoc);
        }
        
        // Function to parse XML back to personal data object
        function parseXMLToPersonalData(xmlString) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlString, "text/xml");
            
            return {
                firstName: xmlDoc.getElementsByTagName("FirstName")[0]?.textContent || "",
                lastName: xmlDoc.getElementsByTagName("LastName")[0]?.textContent || "",
                email: xmlDoc.getElementsByTagName("Email")[0]?.textContent || "",
                phone: xmlDoc.getElementsByTagName("PhoneNumber")[0]?.textContent || "",
                birthdate: xmlDoc.getElementsByTagName("DateOfBirth")[0]?.textContent || "",
                address: xmlDoc.getElementsByTagName("Address")[0]?.textContent || "",
                gender: xmlDoc.getElementsByTagName("Gender")[0]?.textContent || ""
            };
        }

        // ===== DATA MANAGEMENT =====
        let registrationData = {
            personal: {},
            personalXML: "", // Store XML version of personal data
            account: {},
            registrationDate: null,
            status: 'pending'
        };

        // ===== FORM FUNCTIONALITY =====
        let currentStep = 1;

        // Initialize form
        updateProgress();
        setupEventListeners();

        function setupEventListeners() {
            // Real-time username validation
            document.getElementById('username').addEventListener('input', validateUsername);

            // Password strength checker
            document.getElementById('password').addEventListener('input', checkPasswordStrength);

            // Confirm password validation
            document.getElementById('confirmPassword').addEventListener('input', validatePasswordMatch);
        }

        function nextStep() {
            if (!validateCurrentStep()) {
                return;
            }

            // Save data before moving to next step
            saveStepData();

            // Hide current step
            document.getElementById(`step${currentStep}`).classList.remove('active');
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
            
            // Move to next step
            currentStep++;
            
            // Show next step
            document.getElementById(`step${currentStep}`).classList.add('active');
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
            
            updateProgress();
        }

        function prevStep() {
            document.getElementById(`step${currentStep}`).classList.remove('active');
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
            
            currentStep--;
            
            document.getElementById(`step${currentStep}`).classList.add('active');
            document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
            
            updateProgress();
        }

        function updateProgress() {
            const progressFill = document.getElementById('progressFill');
            const progressPercent = (currentStep - 1) * 50;
            progressFill.style.width = `${progressPercent}%`;
        }

        function saveStepData() {
            if (currentStep === 1) {
                // Collect personal information
                const personalData = {
                    firstName: document.getElementById('firstName').value.trim(),
                    lastName: document.getElementById('lastName').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    phone: document.getElementById('phone').value.trim(),
                    birthdate: document.getElementById('birthdate').value,
                    address: document.getElementById('address').value.trim(),
                    gender: document.getElementById('gender').value
                };
                
                // Save as regular object
                registrationData.personal = personalData;
                
                // Convert and save as XML
                registrationData.personalXML = convertPersonalDataToXML(personalData);
                
                // Log the XML data to console (not encrypted as per requirements)
                console.log('=== STEP 1: PERSONAL INFORMATION SAVED ===');
                console.log('Personal Data (Object):', personalData);
                console.log('Personal Data (XML):');
                console.log(registrationData.personalXML);
                console.log('==========================================');
                
            } else if (currentStep === 2) {
                // Get the plain text password and security answer
                const plainPassword = document.getElementById('password').value.trim();
                const plainSecurityAnswer = document.getElementById('securityAnswer').value.trim();
                
                // Encrypt the sensitive data before saving
                const encryptedPassword = encryptText(plainPassword);
                const encryptedSecurityAnswer = encryptText(plainSecurityAnswer);
                
                registrationData.account = {
                    username: document.getElementById('username').value.trim(),
                    password: encryptedPassword, // Store encrypted password
                    securityQuestion: document.getElementById('securityQuestion').value,
                    securityAnswer: encryptedSecurityAnswer, // Store encrypted answer
                    plainPassword: plainPassword // Temporarily store for validation, will be removed later
                };
                
                console.log('=== STEP 2: ACCOUNT SETUP SAVED ===');
                console.log('Username:', registrationData.account.username);
                console.log('Original Password:', plainPassword);
                console.log('Encrypted Password:', encryptedPassword);
                console.log('Security Question:', registrationData.account.securityQuestion);
                console.log('Original Answer:', plainSecurityAnswer);
                console.log('Encrypted Answer:', encryptedSecurityAnswer);
                console.log('Note: Passwords and answers are encrypted in storage');
                console.log('====================================');
            }
        }

        function validateCurrentStep() {
            let isValid = true;
            
            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.success-message').forEach(el => el.style.display = 'none');
            
            if (currentStep === 1) {
                const firstName = document.getElementById('firstName').value.trim();
                const lastName = document.getElementById('lastName').value.trim();
                const email = document.getElementById('email').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const birthdate = document.getElementById('birthdate').value;
                const address = document.getElementById('address').value.trim();
                const gender = document.getElementById('gender').value;
                
                if (!firstName) {
                    document.getElementById('firstNameError').style.display = 'block';
                    isValid = false;
                }
                
                if (!lastName) {
                    document.getElementById('lastNameError').style.display = 'block';
                    isValid = false;
                }
                
                if (!email || !isValidEmail(email)) {
                    document.getElementById('emailError').style.display = 'block';
                    isValid = false;
                }
                
                if (!phone || !isValidPhone(phone)) {
                    document.getElementById('phoneError').style.display = 'block';
                    isValid = false;
                }
                
                if (!birthdate) {
                    document.getElementById('birthdateError').style.display = 'block';
                    isValid = false;
                } else {
                    const age = calculateAge(new Date(birthdate));
                    if (age < 16) {
                        document.getElementById('birthdateError').textContent = 'You must be at least 16 years old';
                        document.getElementById('birthdateError').style.display = 'block';
                        isValid = false;
                    }
                }
                
                if (!address) {
                    document.getElementById('addressError').style.display = 'block';
                    isValid = false;
                }
                
                if (!gender) {
                    document.getElementById('genderError').style.display = 'block';
                    isValid = false;
                }
            }
            
            if (currentStep === 2) {
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value.trim();
                const confirmPassword = document.getElementById('confirmPassword').value.trim();
                const securityQuestion = document.getElementById('securityQuestion').value;
                const securityAnswer = document.getElementById('securityAnswer').value.trim();
                
                if (!username || username.length < 3 || username.length > 20) {
                    document.getElementById('usernameError').style.display = 'block';
                    isValid = false;
                } else if (checkUsernameExists(username)) {
                    document.getElementById('usernameError').textContent = 'Username already taken';
                    document.getElementById('usernameError').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('usernameSuccess').style.display = 'block';
                }
                
                if (!password || password.length < 8) {
                    document.getElementById('passwordError').style.display = 'block';
                    isValid = false;
                }
                
                if (password !== confirmPassword) {
                    document.getElementById('confirmPasswordError').style.display = 'block';
                    isValid = false;
                }
                
                if (!securityQuestion) {
                    document.getElementById('securityQuestionError').style.display = 'block';
                    isValid = false;
                }
                
                if (!securityAnswer) {
                    document.getElementById('securityAnswerError').style.display = 'block';
                    isValid = false;
                }
            }
            
            return isValid;
        }

        function validateUsername() {
            const username = this.value.trim();
            const errorEl = document.getElementById('usernameError');
            const successEl = document.getElementById('usernameSuccess');
            
            errorEl.style.display = 'none';
            successEl.style.display = 'none';
            
            if (username.length < 3) {
                errorEl.textContent = 'Username must be at least 3 characters';
                errorEl.style.display = 'block';
            } else if (username.length > 20) {
                errorEl.textContent = 'Username must be less than 20 characters';
                errorEl.style.display = 'block';
            } else if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                errorEl.textContent = 'Username can only contain letters, numbers, and underscores';
                errorEl.style.display = 'block';
            } else if (checkUsernameExists(username)) {
                errorEl.textContent = 'Username already taken';
                errorEl.style.display = 'block';
            } else {
                successEl.style.display = 'block';
            }
        }

        function checkUsernameExists(username) {
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            return registeredUsers.some(user => user.account?.username === username);
        }

        function checkPasswordStrength() {
            const password = this.value;
            const strengthBar = document.getElementById('passwordStrength');
            let strength = 0;
            
            strengthBar.className = 'strength-bar';
            
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            switch(strength) {
                case 0:
                case 1:
                    strengthBar.className = 'strength-bar strength-weak';
                    break;
                case 2:
                    strengthBar.className = 'strength-bar strength-fair';
                    break;
                case 3:
                    strengthBar.className = 'strength-bar strength-good';
                    break;
                case 4:
                    strengthBar.className = 'strength-bar strength-strong';
                    break;
            }
        }

        function validatePasswordMatch() {
            const password = document.getElementById('password').value;
            const confirmPassword = this.value;
            const errorEl = document.getElementById('confirmPasswordError');
            
            if (confirmPassword && password !== confirmPassword) {
                errorEl.style.display = 'block';
            } else {
                errorEl.style.display = 'none';
            }
        }

        // ===== MAIN SUBMIT FUNCTION =====
        function submitForm() {
            // Validate step 3 (Terms & Conditions)
            const termsAgreed = document.getElementById('termsAgreement').checked;
            const privacyAgreed = document.getElementById('privacyAgreement').checked;
            
            if (!termsAgreed) {
                document.getElementById('termsError').style.display = 'block';
                return;
            } else {
                document.getElementById('termsError').style.display = 'none';
            }
            
            if (!privacyAgreed) {
                document.getElementById('privacyError').style.display = 'block';
                return;
            } else {
                document.getElementById('privacyError').style.display = 'none';
            }
            
            // Complete registration data
            registrationData.registrationDate = new Date().toISOString();
            registrationData.status = 'pending';
            
            // Remove plain password from registrationData before saving
            if (registrationData.account.plainPassword) {
                delete registrationData.account.plainPassword;
            }
            
            // Save to localStorage
            if (saveToLocalStorage()) {
                alert('Registration successful! Your password and security answer have been encrypted for security.');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 500);
            } else {
                alert('Error saving registration. Please try again.');
            }
        }

        function saveToLocalStorage() {
            try {
                const existingUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                
                // Check if user already exists
                const userExists = existingUsers.some(user => 
                    user.account?.username === registrationData.account.username ||
                    user.personal?.email === registrationData.personal.email
                );
                
                if (userExists) {
                    alert('Username or email already exists. Please use different credentials.');
                    return false;
                }
                
                // Add new user with encrypted data
                existingUsers.push(registrationData);
                
                // Save to localStorage
                localStorage.setItem('registeredUsers', JSON.stringify(existingUsers));
                
                console.log('=== REGISTRATION COMPLETE ===');
                console.log('Full Registration Data (encrypted passwords/answers):', registrationData);
                console.log('Personal Information (XML):');
                console.log(registrationData.personalXML);
                console.log('Encrypted Password stored:', registrationData.account.password);
                console.log('Encrypted Answer stored:', registrationData.account.securityAnswer);
                console.log('Data saved to localStorage successfully!');
                console.log('============================');
                
                return true;
            } catch (error) {
                console.error('Error saving to localStorage:', error);
                return false;
            }
        }

        // ===== UTILITY FUNCTIONS =====
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function isValidPhone(phone) {
            return /^[0-9\s\-\(\)]{10,}$/.test(phone.replace(/\D/g, ''));
        }

        function calculateAge(birthdate) {
            const today = new Date();
            let age = today.getFullYear() - birthdate.getFullYear();
            const monthDiff = today.getMonth() - birthdate.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthdate.getDate())) {
                age--;
            }
            
            return age;
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', function() {
            console.log('Registration form ready with XML integration and encryption');
            console.log('Encryption functions available for login verification');
        });
    </script>
    
</body>
</html>