<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Exam - Basic Knowledge Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .timer {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: bold;
            margin-top: 15px;
            display: inline-block;
        }

        .timer.warning {
            background: rgba(255, 0, 0, 0.3);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .content {
            padding: 40px;
        }

        .start-screen {
            text-align: center;
        }

        .start-screen h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .start-screen ul {
            text-align: left;
            max-width: 400px;
            margin: 20px auto;
            line-height: 2;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .question-container {
            display: none;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .question-number {
            font-size: 18px;
            color: #667eea;
            font-weight: bold;
        }

        .question-text {
            font-size: 20px;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .options {
            list-style: none;
        }

        .option {
            background: #f8f9fa;
            margin: 12px 0;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .option:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .option.selected {
            background: #667eea;
            color: white;
            border-color: #764ba2;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .results-screen {
            display: none;
            text-align: center;
        }

        .locked-screen {
            display: none;
            text-align: center;
        }

        .locked-icon {
            font-size: 64px;
            margin: 20px 0;
        }

        .countdown-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 18px;
        }

        .countdown-time {
            color: #667eea;
            font-weight: bold;
            font-size: 24px;
        }

        .score {
            font-size: 48px;
            color: #667eea;
            font-weight: bold;
            margin: 30px 0;
        }

        .score-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Basic Knowledge Exam</h1>
            <div class="timer" id="timer">5:00</div>
        </div>

        <div class="content">
            <!-- Start Screen -->
            <div class="start-screen" id="startScreen">
                <h2>Welcome to the Basic Knowledge Test</h2>
                <ul>
                    <li>Total Questions: 16</li>
                    <li>Time Limit: 5 minutes</li>
                    <li>Each question has 4 options</li>
                    <li>Select one answer per question</li>
                </ul>
                <button class="btn" onclick="startExam()">Start Exam</button>
            </div>

            <!-- Question Screen -->
            <div class="question-container" id="questionContainer">
                <div class="question-header">
                    <span class="question-number" id="questionNumber">Question 1 of 16</span>
                    <span id="timeRemaining"></span>
                </div>
                <div class="question-text" id="questionText"></div>
                <ul class="options" id="options"></ul>
                <div class="navigation">
                    <button class="btn btn-secondary" onclick="previousQuestion()" id="prevBtn">Previous</button>
                    <button class="btn" onclick="nextQuestion()" id="nextBtn">Next</button>
                </div>
            </div>

            <!-- Results Screen -->
            <div class="results-screen" id="resultsScreen">
                <h2>Exam Completed!</h2>
                <div class="score" id="score"></div>
                <div class="score-details" id="scoreDetails"></div>
                <p style="margin-top: 20px; color: #6c757d;">You can retake this exam in 7 days.</p>
            </div>

            <!-- Locked Screen -->
            <div class="locked-screen" id="lockedScreen">
                <div class="locked-icon">üîí</div>
                <h2>Exam Currently Unavailable</h2>
                <div class="countdown-info">
                    <p>You have already completed this exam.</p>
                    <p style="margin: 15px 0;">You can retake it in:</p>
                    <div class="countdown-time" id="countdownTime"></div>
                </div>
                <div class="score-details" id="lastScore"></div>
            </div>
        </div>
    </div>

    <script>
        // XML data containing all questions
        const xmlData = `<?xml version="1.0" encoding="UTF-8"?>
<exam>
    <question>
        <text>What is the capital of France?</text>
        <options>
            <option correct="false">London</option>
            <option correct="true">Paris</option>
            <option correct="false">Berlin</option>
            <option correct="false">Madrid</option>
        </options>
    </question>
    <question>
        <text>What is 2 + 2?</text>
        <options>
            <option correct="false">3</option>
            <option correct="true">4</option>
            <option correct="false">5</option>
            <option correct="false">6</option>
        </options>
    </question>
    <question>
        <text>Which planet is known as the Red Planet?</text>
        <options>
            <option correct="false">Venus</option>
            <option correct="false">Jupiter</option>
            <option correct="true">Mars</option>
            <option correct="false">Saturn</option>
        </options>
    </question>
    <question>
        <text>What is the largest ocean on Earth?</text>
        <options>
            <option correct="false">Atlantic Ocean</option>
            <option correct="true">Pacific Ocean</option>
            <option correct="false">Indian Ocean</option>
            <option correct="false">Arctic Ocean</option>
        </options>
    </question>
    <question>
        <text>How many continents are there?</text>
        <options>
            <option correct="false">5</option>
            <option correct="false">6</option>
            <option correct="true">7</option>
            <option correct="false">8</option>
        </options>
    </question>
    <question>
        <text>What is the boiling point of water at sea level?</text>
        <options>
            <option correct="false">90¬∞C</option>
            <option correct="true">100¬∞C</option>
            <option correct="false">110¬∞C</option>
            <option correct="false">120¬∞C</option>
        </options>
    </question>
    <question>
        <text>Who painted the Mona Lisa?</text>
        <options>
            <option correct="false">Pablo Picasso</option>
            <option correct="false">Vincent van Gogh</option>
            <option correct="true">Leonardo da Vinci</option>
            <option correct="false">Michelangelo</option>
        </options>
    </question>
    <question>
        <text>What is the chemical symbol for gold?</text>
        <options>
            <option correct="false">Go</option>
            <option correct="false">Gd</option>
            <option correct="true">Au</option>
            <option correct="false">Ag</option>
        </options>
    </question>
    <question>
        <text>How many days are in a leap year?</text>
        <options>
            <option correct="false">364</option>
            <option correct="false">365</option>
            <option correct="true">366</option>
            <option correct="false">367</option>
        </options>
    </question>
    <question>
        <text>What is the smallest prime number?</text>
        <options>
            <option correct="false">0</option>
            <option correct="false">1</option>
            <option correct="true">2</option>
            <option correct="false">3</option>
        </options>
    </question>
    <question>
        <text>Which gas do plants absorb from the atmosphere?</text>
        <options>
            <option correct="false">Oxygen</option>
            <option correct="false">Nitrogen</option>
            <option correct="true">Carbon Dioxide</option>
            <option correct="false">Hydrogen</option>
        </options>
    </question>
    <question>
        <text>What is the speed of light approximately?</text>
        <options>
            <option correct="false">300,000 km/h</option>
            <option correct="true">300,000 km/s</option>
            <option correct="false">150,000 km/s</option>
            <option correct="false">500,000 km/s</option>
        </options>
    </question>
    <question>
        <text>How many sides does a hexagon have?</text>
        <options>
            <option correct="false">5</option>
            <option correct="true">6</option>
            <option correct="false">7</option>
            <option correct="false">8</option>
        </options>
    </question>
    <question>
        <text>What is the largest mammal in the world?</text>
        <options>
            <option correct="false">African Elephant</option>
            <option correct="true">Blue Whale</option>
            <option correct="false">Giraffe</option>
            <option correct="false">Polar Bear</option>
        </options>
    </question>
    <question>
        <text>In which year did World War II end?</text>
        <options>
            <option correct="false">1944</option>
            <option correct="true">1945</option>
            <option correct="false">1946</option>
            <option correct="false">1947</option>
        </options>
    </question>
    <question>
        <text>What is the primary language spoken in Brazil?</text>
        <options>
            <option correct="false">Spanish</option>
            <option correct="true">Portuguese</option>
            <option correct="false">English</option>
            <option correct="false">French</option>
        </options>
    </question>
</exam>`;

        let questions = [];
        let currentQuestion = 0;
        let userAnswers = [];
        let timerInterval;
        let timeLeft = 300; // 5 minutes in seconds
        const RESET_DAYS = 7;
        const STORAGE_KEY = 'examData';

        // Parse XML data
        function parseXML() {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlData, "text/xml");
            const questionNodes = xmlDoc.getElementsByTagName("question");

            for (let i = 0; i < questionNodes.length; i++) {
                const questionNode = questionNodes[i];
                const text = questionNode.getElementsByTagName("text")[0].textContent;
                const optionNodes = questionNode.getElementsByTagName("option");
                const options = [];

                for (let j = 0; j < optionNodes.length; j++) {
                    options.push({
                        text: optionNodes[j].textContent,
                        correct: optionNodes[j].getAttribute("correct") === "true"
                    });
                }

                questions.push({ text, options });
                userAnswers.push(null);
            }
        }

        // Check if exam is available
        function checkExamAvailability() {
            const examData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            
            if (examData.completedAt) {
                const completedDate = new Date(examData.completedAt);
                const now = new Date();
                const daysPassed = (now - completedDate) / (1000 * 60 * 60 * 24);
                
                if (daysPassed < RESET_DAYS) {
                    showLockedScreen(completedDate, examData);
                    return false;
                }
            }
            return true;
        }

        function showLockedScreen(completedDate, examData) {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('lockedScreen').style.display = 'block';
            
            // Display last score
            if (examData.score !== undefined) {
                document.getElementById('lastScore').innerHTML = `
                    <h3>Your Last Score: ${examData.score.percentage}%</h3>
                    <p>Correct Answers: ${examData.score.correct} / ${examData.score.total}</p>
                `;
            }
            
            updateCountdown(completedDate);
            setInterval(() => updateCountdown(completedDate), 1000);
        }

        function updateCountdown(completedDate) {
            const resetDate = new Date(completedDate);
            resetDate.setDate(resetDate.getDate() + RESET_DAYS);
            
            const now = new Date();
            const timeDiff = resetDate - now;
            
            if (timeDiff <= 0) {
                location.reload();
                return;
            }
            
            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
            
            document.getElementById('countdownTime').textContent = 
                `${days}d ${hours}h ${minutes}m ${seconds}s`;
        }

        function saveExamCompletion(correct, total, percentage) {
            const examData = {
                completedAt: new Date().toISOString(),
                score: {
                    correct: correct,
                    total: total,
                    percentage: percentage
                }
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(examData));
        }

        function startExam() {
            if (!checkExamAvailability()) return;
            
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('questionContainer').style.display = 'block';
            startTimer();
            displayQuestion();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();

                if (timeLeft <= 60) {
                    document.getElementById('timer').classList.add('warning');
                }

                if (timeLeft <= 0) {
                    endExam();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function displayQuestion() {
            const question = questions[currentQuestion];
            document.getElementById('questionNumber').textContent = 
                `Question ${currentQuestion + 1} of ${questions.length}`;
            document.getElementById('questionText').textContent = question.text;

            const optionsList = document.getElementById('options');
            optionsList.innerHTML = '';

            question.options.forEach((option, index) => {
                const li = document.createElement('li');
                li.className = 'option';
                li.textContent = option.text;
                if (userAnswers[currentQuestion] === index) {
                    li.classList.add('selected');
                }
                li.onclick = () => selectOption(index);
                optionsList.appendChild(li);
            });

            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            document.getElementById('nextBtn').textContent = 
                currentQuestion === questions.length - 1 ? 'Submit' : 'Next';
        }

        function selectOption(index) {
            userAnswers[currentQuestion] = index;
            const options = document.querySelectorAll('.option');
            options.forEach((opt, i) => {
                opt.classList.toggle('selected', i === index);
            });
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                displayQuestion();
            }
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                displayQuestion();
            } else {
                endExam();
            }
        }

        function endExam() {
            clearInterval(timerInterval);
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'block';
            calculateScore();
        }

        function calculateScore() {
            let correct = 0;
            questions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                if (userAnswer !== null && question.options[userAnswer].correct) {
                    correct++;
                }
            });

            const percentage = ((correct / questions.length) * 100).toFixed(1);
            const passed = percentage >= 75;
            
            // Save exam completion with score
            saveExamCompletion(correct, questions.length, percentage);
            
            // Save exam result to session storage for dashboard
            const examResult = {
                score: parseFloat(percentage),
                passed: passed,
                correct: correct,
                total: questions.length,
                dateTaken: new Date().toISOString(),
                applicationId: new URLSearchParams(window.location.search).get('applicationId')
            };
            sessionStorage.setItem('examResult', JSON.stringify(examResult));
            
            document.getElementById('score').textContent = `${correct} / ${questions.length}`;
            document.getElementById('scoreDetails').innerHTML = `
                <h3>Score: ${percentage}%</h3>
                <p>Correct Answers: ${correct}</p>
                <p>Wrong Answers: ${questions.length - correct}</p>
                <p>Time Taken: ${formatTime(300 - timeLeft)}</p>
                <p style="margin-top: 15px; padding: 10px; border-radius: 5px; background: ${passed ? '#e8f5e9' : '#ffebee'}; color: ${passed ? '#2e7d32' : '#c62828'};">
                    ${passed ? '‚úÖ You passed the exam!' : '‚ùå Score below passing (75%)'}
                </p>
                <button class="btn btn-primary" style="margin-top: 20px;" onclick="returnToDashboard()">
                    Return to Dashboard
                </button>
            `;
        }
        
        function returnToDashboard() {
            window.location.href = 'student-dashboard.html';
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Initialize
        parseXML();
        
        // Check exam availability on page load
        window.onload = function() {
            checkExamAvailability();
        };
    </script>
</body>
</html>